services:
  # Download services
  deluge:
    image: linuxserver/deluge:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${CONFIG}/deluge:/config
      - ${DOWNLOADS}:/downloads
    ports:
      - 8112:8112
      - 6881:6881
      - 6881:6881/udp
  prowlarr:
    image: linuxserver/prowlarr:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=002
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG}/prowlarr:/config
    ports:
      - 9696:9696
  radarr:
    image: linuxserver/radarr:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG}/radarr:/config
      - ${DOWNLOADS}:/downloads
      - ${MEDIA}/films:/films
    ports:
      - 7878:7878
    depends_on:
      - deluge
      - prowlarr
  sonarr:
    image: linuxserver/sonarr:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG}/sonarr:/config
      - ${DOWNLOADS}:/downloads
      - ${MEDIA}/shows:/shows
    ports:
      - 8989:8989
    depends_on:
      - deluge
      - prowlarr

  # Dashboard
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - HOMEPAGE_ALLOWED_HOSTS=${DOMAIN:-localhost}
    volumes:
      - ${CONFIG}/homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock:ro
    ports:
      - 3000:3000

  # Reverse proxy (requires TS_AUTHKEY, DOMAIN, CF_API_TOKEN, CF_ZONE_ID)
  caddy:
    build: ${CONFIG}/caddy
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - DOMAIN=${DOMAIN:-}
      - CF_API_TOKEN=${CF_API_TOKEN:-}
      - CF_ZONE_ID=${CF_ZONE_ID:-}
      - TS_API_KEY=${TS_API_KEY:-}
    volumes:
      - ${CONFIG}/caddy/Caddyfile:/etc/caddy/Caddyfile
      - ${CONFIG}/caddy/data:/data
      - ${CONFIG}/caddy/config:/config

  # Media server
  jellyfin:
    image: linuxserver/jellyfin:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${CONFIG}/jellyfin:/config
      - ${MEDIA}/films:/data/films
      - ${MEDIA}/shows:/data/shows
    ports:
      - 8096:8096

  # File management
  filebrowser:
    image: filebrowser/filebrowser:latest
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - ${CONFIG}:/srv/config
      - ${CONFIG}/filebrowser:/config
      - ${DOWNLOADS}:/srv/downloads
      - ${MEDIA}:/srv/media
    ports:
      - 8080:80

  # Container management
  portainer:
    image: portainer/portainer-ce:lts
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${CONFIG}/portainer:/data
    ports:
      - 9000:9000
